# 指令列表
目前以实现的服务主要分为:基础ai,天气,场景(地理)推理,影像处理,
<br>基础应用,语义转化,机器操作,绘制图表等几个大类
<br>目前主要使用4台服务器PC部署对应的服务,日均电费约为￥5

## 基础ai服务
<br>生成推理的基础ai服务,主要为混合模式
<br>通过本地部署结合在线服务的形式来均衡成本
<br>其中'图像多轮推理','图像多轮推理','声音分析'服务主要基于'通义千问';
<br>其他主要为本地及在线的'chatglm','DeepSeek'
### 文本推理
文本推理服务通过在指令中嵌入待推理的文本,以完成对问题的推理;
```
指令:基础ai;文本推理,<推理模型>,<prompt>
指令:基础ai;文本推理,<prompt>  //默认'chatglm'
指令:基础ai;推理服务,<prompt>
```
此外拥有一个变体服务'推理服务'
```
指令:基础ai;推理服务,<推理模型>,<messages>
//messages参数接受一个符合 OpenAI SDK标准的messages
[{"role": "system", "content": "XXX"},     {"role": "user", "content": "YYY"} ]
```

### 图像推理
图像推理服务通过在指令中嵌入待推理的文本,及待推理的图片完成对图像的推理;
<br>当指令中表述图片位置的槽位内容在用户输入时亦可不为url,
<br>我在私有化项目中通过js完成用户输入到url的转化
```
指令:基础ai;图像推理,<推理模型>,<prompt>,<url> 
指令:基础ai;图像推理,<prompt>,<url>  //默认'chatglm'
```
### 图像多轮推理
图像多轮推理服务在'图像推理'上支持同时对图像提多个问题
<br>以一张图像两次提问为例,当完成第一个'prompt'对'图像'的分析结果后,
<br>服务将'第一个问题的结果'及'第二个问题'追加到'messages'中供ai提问
```
指令:基础ai;图像多轮推理,<推理模型>,<prompt_list>,<url> 
```
### 多图像推理
图像多轮推理服务在'图像推理'上支持同时对多个图像进行一个问题的推理
```
指令:基础ai;图像多轮推理,<推理模型>,<prompt>,<url_list> 
```

### 声音分析
声音分析服务通过在指令中嵌入待推理的文本,及待推理的音频完成对音频的推理;
```
指令:基础ai;声音分析,<prompt>,<url> 
```
### 网页分析
<br>网页分析服务是对'文本推理'及'图像推理'的一种聚合分析
<br>后台服务通过开启一个''获取目标网页的截图,及页面文本
<br>分别对'页面文本'及'网页截图'进行'文本推理'及'图像推理'并将结果做为一个'rule'
<br>将用户的'prompt'及前序推理收集的'rule'打包为一个新的'messages'调用'推理服务'
<br>由此得到基于'prompt'对预期页面的基础分析
```
指令:基础ai;网页分析,<prompt>,<url> 
```

## 天气服务
<br>天气服务主要通过关于天气的在线服务获取天气情况,并综合其他服务完成具象功能,
<br>从'天气服务'从'基础应用'服务中提出,主要因为天气信息具有较强的时空属性,
<br>除天'穿衣'指数外还可根据服务的具体情况根据其他需要接入
<br>例如:'运动','洗车','紫外线','钓鱼','旅游'等若干项指数
### 天气查询
天气查询服务的主要作用在于为本地LLM推理提供实时数据
```
指令:天气指数;天气查询,<时间>,<所在城市> 
	-返回{'<时间>':'<气温变化>,<气象变化>,<日出时间>'}
```
### 穿衣
穿衣指数根据天气信息返回符合中国气象局发布的'穿衣气象指数'(行业标准)的衣服标签
```
指令:天气指数;穿衣,<时间>,<所在城市> 
	-返回[<衣服标签1>,<衣服标签2>,<衣服标签3>]
```
### 用户穿衣
<br>用户穿衣服务根据用户的衣橱生成对应时段的穿搭
<br>用户穿衣是对'穿衣'和'获取资源'等服务的聚合应用
<br>当指令被激活后,获取该时段的'衣服标签'后再从'获取资源'按标签过滤出合适的衣服,
<br>将过滤出的衣服实例转化为可以被LLM推理的对象,通过LLM生成适宜的穿搭推荐
<br>向用户返回穿搭组合的图片或虚拟试衣结果
```
指令:天气指数;用户穿衣,<时间>,<所在城市>,<用户>  
	-返回[<穿搭组合1>,<穿搭组合2>,<穿搭组合3>]
```

## 场景推理服务
<br>场景推理服务对'数字孪生场景'进行各种数据处理
<br>该服务相较传统'智慧园区','智慧工厂'的玩法,
<br>更专注于解决'个人'对于'数字孪生空间'的需要,
<br>通过对'数字孪生空间'进行推理和计算完成对空间中对象的实际操作,
<br>目前对'图形引擎'的消费仅考虑能进行基础的'动画'及'物理模拟'
数字孪生空间详见[数字孪生相关](https://github.com/weihai-limh/daytime_agent/blob/main/document/docs/digital_twin_correlation.md)
### 空间导航
<br>空间导航服务根据指令中涉及的两个空间(房间)名称生成所在'数字孪生场景'的路径导航
<br>'空间导航'指令默认接受两个入参(出发点,到达点),当只有一个入参时第二个点为'出发点'
<br>否则出发点为该'数字孪生场景'的默认出发点
```
指令:场景推理;空间导航,<到达点>
指令:场景推理;空间导航,<到达点>,<出发点>
```
<br>在一般模式中由AI直接对'数字孪生场景'进行推理,得到'室内的空间路径'
<br>'图形引擎'基于'室内的空间路径'生成符合物理规则的'室内导航路径'
### 资产导航
<br>'资产导航'是'资产导航'的进一步应用,'资产实例'物理存在于'空间'中的一个容器.
<br>由此服务会通过'资产实例'->'容器实例'->'空间'找到空间后生成'室内导航路径'
```
指令:场景推理;资产导航,<到达点>
指令:场景推理;资产导航,<到达点>,<出发点>
```

### 建筑计算
建筑计算服务根据指令中涉及的参数进行计算
建筑计算中有
```
指令示例
```
### 建筑推理
建筑推理服务从指令中提取'数字孪生场景'及要推理的'问题'
通过服务将'数字孪生场景'的数据及'问题转化为建筑类prompt供LLM推理
```
指令示例
```
### 空间推理
空间推理服务从指令中提取'数字孪生场景'及要推理的'问题'
通过服务将'数字孪生场景'的数据及'问题转化为空间类prompt供LLM推理
```
指令示例
```
### 容器查看
容器查看服务从指令中提取'数字孪生场景'及'容器名称'.
通过服务在'数字孪生场景'中查找该容器,如果该容器存在则返回容器内的'资产实例'
```
指令示例
```

## 影像处理服务

### 文生图
文生图服务根据指令中对于预期图像的描述,生成对于的图像
文生图服务结合在线服务及本地服务来均衡成本
在线服务主要调用'智谱','通义万象'
```
指令示例
```
### 遮罩生成
遮罩生成服务根据指令中的图像url及遮罩模式及参数处理对应的图像
遮罩生成有四种模态分别为
该服务主要应用''
```
指令示例
```
### 局部重绘(涂鸦转画,涂鸦转画,画面拓展,海报生成)
局部重绘等服务出于成本考虑,目前主要接入'通义万象'api
服务通过从指令中提取参数调用对应api提交参数
该服务通过指令'任务查询'获得结果
该类指令可以和'遮罩生成'衔接使用
```
指令示例
```
### 虚拟模特
虚拟模特服务出于成本考虑,目前接入'通义万象'及'可灵'api,
服务通过从指令中提取参数调用对应api提交参数
该服务通过指令'任务查询'获得结果
目前虚拟模特服务调用一次成本约￥0.5
```
指令示例
```
### 图像补全(内容替换,内容补全)
图像补全封装了'通义万象'的在线服务
该服务接受一个图像及改图像的遮罩图像及对改图像的处理模式来处理图片
'内容替换服务及内容补全服务'封装了'遮罩生成'和'图像补全'
服务通过接受图像后根据参数调用'遮罩生成'生成对应遮罩然后进行对应的'图像补全'
```
指令示例
```
### 深度转换
<br>深度转换服务根据指令中的图像url及深度转换处理对应的图像
<br>深度转换有两种模式分别为'还原深度','深度动图'
<br>该服务主要封装'Depth Anything V2'等项目实现
```
指令:影像处理;深度转换,<文件url>,<转化模式>
```
### 点云转换
<br>点云转换服务根据指令中的图像url及点云转换处理对应的图像
<br>点云转换有两种模式分别为'点云'和'三维重建'分别输出'.ply'及'.splat'
<br>该服务主要封装'open3d','Depth Pro'等项目实现
```
指令:影像处理;点云转换,<文件url>,<转化模式>
```
### 视频转序列图片
<br>视频转序列图片服务根据指令中的视频url及参数处理对应的视频
<br>该服务主要应用''完成对视频的处理
<br>类似指令还包括'图片序列转视频','格式转化','裁剪视频起始时长','裁剪视频起始时长'
<br>'裁剪视频起始终止','获取指定视频帧','压缩视频','更改视频分辨率'
<br>'视频提取音频','视频去音频','视频加音频'
```
指令示例
```

## 基础应用服务
基础应用服务主要内容为日常应用并且不被特定领域包括的服务
### 中译英
<br>中译英服务通过封装在线的翻译服务完成翻译
<br>该服务从指令中提取'待翻译的文本'然后将其翻译为英文
```
指令:基础应用服务;中译英,<待翻译文本>
```
### 语言转化
语言转化服务是'中译英'的升级,通过加入一个语言转化参数来支持更多类型的语言翻译
```
指令:基础应用服务;语言转化,<待翻译文本>,<语言翻译类型>
```
### 语音识别
语音识别也是通过封装在线的语音识别服务实现对应功能
```
指令:基础应用服务;语音识别,<文件url>
```
### 任务查询
<br>任务查询服务集成了多种异步任务的查询,
<br>查询后返回对应任务的执行结果
```
指令:基础应用服务;任务查询,<任务类型>,<任务id>
```
### 发送邮件
<br>发送邮件服务通过本地部署的邮件服务器
<br>通过改服务向目标邮箱发送对应文件
```
指令:基础应用服务;发送邮件,<收件邮箱>,<标题>,<内容>
```
### 获取资源
<br>获取资源服务从指令中提取要查询的资源参数进而查询资源,
<br>资源分为'资源原型'和'资源实例','资源实例'比'资源原型'多一个'用户代称'的查询参数
<br>'资源原型'仅需'资源类型','资源标签'两个参数
```
指令:基础应用服务;获取资源,<获取资源标签>,<获取资源类型>
指令:基础应用服务;获取资源,<获取资源标签>,<获取资源类型>,<用户>
```
<br>所有'资源实例'均有'用户',默认资源属于其所在的'空间'
<br>在应用某空间的资源时,'用户'属于该'空间'的'资源实例'做为'公共资源'被调用消费
### 语音合成
<br>发送邮件服务通过本地部署的邮件服务器
<br>通过改服务向目标邮箱发送对应文件
```
指令:基础应用服务;语音合成,<语音模板>,<待合成模板>
```

## 语义转化服务
### 建筑模型转建筑语义
<br>建筑模型转建筑语义服务将建筑模型(.ifc)转化为符合建筑语义的'数字孪生场景'
<br>服务通过'IfcOpenShell'完成IFC文件的预处理,完成语义数据和几何数据的提取,
<br>后续通过按'数字孪生场景的建筑模板'转化对应的属性
```
指令:语义转化;建筑模型转建筑语义,<建筑信息模型文件url>
```
### 建筑模型转空间语义
<br>建筑模型转空间语义服务在'建筑模型转建筑语义'的基础上完成对应的转化后
<br>后续通过按'数字孪生场景的空间模板'转化对应的属性
```
指令:语义转化;建筑模型转空间语义,<建筑信息模型文件url>
```
### 地理信息数据转geojson
地理信息数据转geojson服务将(.shp,.gpx)格式的文件转化为geojson结构的数据
```
指令:语义转化;地理信息数据转geojson,<模板>,<地理信息数据url>
```
### 文本转知识图谱
<br>文本转知识图谱将通过解析指定格式的(.txt)或文本内容,
<br>将解析的内容转化为'图结构',通过绘制图表的'知识图谱'指令生成对应图表
```
指令:语义转化;文本转知识图谱,<模板>,<文本url>
```
### 文本转ppt
<br>文本转ppt服务将通过解析指定格式的(.txt)或文本内容,
<br>将解析的内容通过'python-pptx'生成对应的(.ppt)文件
```
指令:语义转化;文本转ppt,<模板>,<文本url>
```

## 机器操作服务
机器操作服务通过指令让目标机械执行对应的行为
### 空间移动
<br>空间移动服务接受一个'导航路径'和一个机器名称
<br>如果该机器在'导航路径'所在的'数字孪生场景'中
<br>则让该机器按'导航路径'在'数字孪生场景'对应的现实空间中行驶
<br>其中'导航路径'对应的数据为指令'资产导航'或'建筑导航'生成的室内导航数据
<br>后台服务将'导航路径'根据时序分解为机器的'执行动作指令'
```
指令:机器操作;机器执行,<数字孪生场景>,<机器名称>,<导航路径url>
```
其他执行动作指令详见[数字孪生相关](https://github.com/weihai-limh/daytime_agent/blob/main/document/docs/digital_twin_correlation.md)
### 工作流
<br>机器操作的工作流服务接受一个'动作序列'和一个机器名称
<br>服务根据机器名称将'动作序列'写入到机器上,机器按序列执行动作
```
指令:机器操作;机器执行,<数字孪生场景>,<机器名称>,<工作流文件url>
```
### 机器执行
<br>机器操作的工作流服务接受一个'机器执行动作'和一个机器名称
<br>服务将'机器执行动作'转化为机器的执行指令并推送到机器供机器执行
```
指令:机器操作;机器执行,<数字孪生场景>,<机器名称>,<执行动作指令>
```
其他执行动作指令详见[数字孪生相关](https://github.com/weihai-limh/daytime_agent/blob/main/document/docs/digital_twin_correlation.md)
## 地理空间服务
<br>地理空间服务服务通过指令返回对应的geojson信息
<br>地理空间对应的数据源来自在线地图服务(百度,高德,天地图)及OSM
<br>除公域数据外个人数据通过'地理信息数据转geojson'将各类数据转化为geojson
<br>拓扑计算等一般应用通过QGIS进行对应的数据处理,空间句法等应用结合neo4j完成
### 网址查询
<br>网址查询服务通过传入的网址或ip返回对应城市的所在经纬度
<br>并通过h3生成城市范围的geojson
```
指令:地理空间;经纬度查询,<ip>
指令:地理空间;地址查询,<网址>
```
### 经纬度查询(地址查询)
<br>经纬度查询服务及地址查询查询通过传入的经纬度及坐标和辅助参数进行处理
<br>服务根据参数以geojson的格式返回热点的空间信息
```
指令:地理空间;经纬度查询,<经度>,<纬度>
指令:地理空间;地址查询,<地点名称>
```
### 静态地图
静态地图服务通过传入的参数(至少包含经纬度),返回绘制地图的png
```
指令:地理空间;静态地图,<要渲染展示的地图数据>
```
### 动态地图
静态地图服务通过传入的参数(经纬度,geojson),返回渲染数据的网页地图(ArcGISJS)
```
指令:地理空间;动态地图,<要渲染展示的地图数据>
```
### 位置查找(位置连线,行政范围)
<br>位置查找服务与位置连线服务,行政范围服务相类似
<br>该类服务是'经纬度查询','地址查询'的升级应用
<br>服务通过'经纬度查询','地址查询'获得经纬度信息后结合需要生成新的geojson
```
指令:地理空间;位置查找,<地点名称>,<扩散范围>
指令:地理空间;位置连线,<地点名称1>,<地点名称2>
指令:地理空间;行政范围,<行政区划名称>
```
### 室外导航
室外导航服务通过指令中的起止点生成对应的室外导航路径
并根据调用行驶返回'导航数据'或渲染数据的网页地图(ArcGISJS)
```
指令:地理空间;室外导航,<出发点>,<到达点>
```

## 绘制图表服务
绘制图表服务通过指令生成符合指令数据的图表网页
### 柱状图(折线图,散点图,饼图)
柱状图与折线图,散点图,饼图对应的指令驱动参数类似
```
指令:绘制图表;柱状图,<绘制参数>
指令:绘制图表;饼图,<绘制参数>
//以'柱状图'为例
指令:绘制图表;柱状图,{"薯片":15,"水":25}
```
### 盒须图(平行坐标系,树图,矩形树图)
盒须图与平行坐标系,树图,矩形树图对应的指令驱动参数类似
```
指令:绘制图表;盒须图,<绘制参数>
指令:绘制图表;平行坐标系,<绘制参数>
//以'平行坐标系'为例

```
### 知识图谱
知识图谱通过加载表述图结构的json文件生成图
```
指令示例
```
### 流程图
流程图对应的参数为原生语法
```
指令示例
```